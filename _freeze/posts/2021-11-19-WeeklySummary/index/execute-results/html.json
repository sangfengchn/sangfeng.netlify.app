{
  "hash": "39452e1c213f7494e994de5a24dcba0e",
  "result": {
    "markdown": "---\ntitle: Weekly summary\nauthor: 桑峰\ndate: 2021-11-19\nslug: blog\noutput: html_document\ncategories:\n  - Summary\ntags:\n  - R\n  - colormap\n  - bar plot\n  - ggplot2\n---\n\n\n## 自定义Colormap\n\n在一些场景下，我们需要自己构造数字与颜色的对应关系。比如，我们在探究每个ROI随龄变化的趋势时，我们需要将回归方程中年龄的系数展示在脑图上。朴素的想法是，我构造一个关于系数与颜色的映射关系，给定某一系数，就返回相应的颜色。实现方法如下：\n\n```R\nlibrary(tidyverse)\nlibrary(RColorBrewer)\n\ndata <- data.frame(Val = rnorm(100)) %>% as_tibble()\n\n# 选择合适的颜色\ncolors <- brewer.pal(11, 'RdBu')\n# 考虑到数字的正负号，我们这里用差异较明显的颜色区分正负\npos.color <- colorRampPalette(colors[6:1])(1000 * round(max(data$Val), 3) + 1)\nneg.color <- colorRampPalette(colors[6:11])(-1000 * round(min(data$Val), 3) + 1)\n\nres <- rep('', length(data$Val))\nfor (i in 1:length(data$Val)) {\n  if (round(data$Val[i], 3) < 0) {\n    res[i] <- neg.color[1000 * round(-data$Val[i], 3)]\n  } else if (round(data$Val[i], 3) > 0) {\n    res[i] <- pos.color[1000 * round(data$Val[i], 3)]\n  } else {\n    res[i] <- pos.color[1]\n  }\n}\ndata['Color'] <- res\ndata[, c('Red', 'Green', 'Blue')] <- t(col2rgb(res)) / 255\n\n# 演示颜色\nggplot(data = data, aes(x = Val, y = Val)) +\n  geom_point(color = data$Color, size = 10)\n```\n\n其中，data中同一行表示数字与对应的颜色。\n\n效果如下所示：\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](./img/fig_01.png){width=975}\n:::\n:::\n\n\n## 带误差线的柱状图\n\n```R\nlibrary(tidyverse)\n\ndata <- data.frame(\n  val = rnorm(10) + 5,\n  error = rnorm(10),\n  name = letters[1:10]\n)\ndata %>%\n  ggplot(aes(x = name, y = val)) +\n  geom_bar(stat = 'identity') +\n  # 添加误差线\n  geom_errorbar(aes(ymin = val - error, ymax = val + error, width = 0.2)) +\n  labs(y = 'Val', x = '') +\n  theme_bw() + \n  theme(legend.position = 'None',\n        axis.title = element_text(size = 20),\n        axis.text = element_text(size = 16, colour = 'black'),\n        panel.border = element_rect(size = 1.5),\n        # 将x轴标签旋转一定角度\n        axis.text.x = element_text(size = 30, angle = 45, vjust = 1, hjust = 1))\n```\n\n效果如下所示：\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](./img/fig_02.png){width=583}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}