{
  "hash": "1bd09f3a61c0c82afc2b2a5d787ea97f",
  "result": {
    "markdown": "---\ntitle: Singularity-03-创建镜像\nauthor: 桑峰\ndate: 2021-06-01\nslug: blog\noutput: html_document\ncategories:\n  - 服务器\ntags:\n  - singularity\n  - wsl\n---\n\n\n在Windows 10的Linux子系统（**WLS**）中安装singularity(version=2.6.0)，并创建镜像。\n\n在之前多次尝试中发现，在直接创建.simg镜像时会报告错误（Error: no more available loop devices.），导致创建失败。尝试发现可以通过添加**--sandbox**参数解决。完整命令如下：\n\n\n```bash\nsudo singularity build --sandbox image_name library/recipes\n```\n\n其中，image_name为镜像的名称，library/recipes可以为shub，docker链接或符合singularity语法的配置文件（config.def）。如果在wsl中，输入上述命令后，提示无法找到此命令，而直接输入singularity可以正常显示相关信息。那么可以为singularity创建链接文件解决。\n\n```bash\nsudo ln -s /usr/local/singularity/bin/singularity /usr/bin/singularit\n```\n\n配置文件实例：\n\n```bash\nBootstrap: yum\n\nOSVersion: 7\n\nMirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/\n\nInclude: yum\n\n%labels\n\n    Python version: 3.9.5\n\n    R version: 4.1.0\n\n\n%post\n\n    yum -y update\n\n    yum -y groupinstall \"Development Tools\"\n\n    yum install -y gcc gcc-c++ gcc-gfortran java-1.8.0-openjdk.x86_64 java-1.8.0-openjdk-devel.x86_64\n\n    yum install -y readline-devel bzip2-devel libXt-devel fonts-chinese tcl tcl-devel tclx tk tk-devel mesa-libGLU mesa-libGLU-devel libcurl libcurl-devel xz-devel.x86_64 libjpeg-devel pcre2-devel libtiff-devel libicu-devel which vim\n\n%environment\n\n    export LC_ALL=C\n```\n\n奇怪的是，如果把配置文件的名称改为demo.def或test.def，则无法创建镜像。\n\n等创建完成，可以在运行命令中添加**--writable**参数运行镜像，并在镜像中安装相关的软件。\n\n```bash\nsingularity shell --writable image_name\n```\n\n软件安装完成后，可以通过如下命令将镜像重新打包为.simg文件。\n\n```bash\nsingularity build image_name.simg image_name/\n```\n\n### 参考\n\n[1] https://sylabs.io/guides/2.5/admin-guide/\n\n[2] https://sylabs.io/guides/2.6/user-guide/",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}