{
  "hash": "4afe977a7f8666eeaf862f0883d191a9",
  "result": {
    "markdown": "---\ntitle: Singularity-04-安装MATLAB\nauthor: 桑峰\ndate: 2022-02-17\nslug: blog\noutput: html_document\ncategories:\n  - singularity\ntags:\n  - singularity\n  - matlab\n  - 服务器\n  - centos\n---\n\n\n以下是记录本人在使用学院高性能计算平台运行singularity中遇到的问题以及相应的解决方法，不一定适用于其他场景。\n\n# 建立基础镜像\n\n```bash\nsudo singularity build --sandbox tmp/ docker://centos:7\n```\n\n尝试过ubuntu:20.04和18.04，在服务器上均会报告“**FATAL: kernel too old**”的错误。Centos6.10和7可以，但是6.10的yum源已经不再支持。因此使用Centos7作为基础镜像。\n\n# 安装MATLAB\n\n这里参考：https://zhuanlan.zhihu.com/p/394298249\n\n需要注意的是，安装之前，需要在系统里面安装一些库文件和编译器，命令如下：\n\n```bash\nyum install libX11 libXmu\nyum install gcc java-11-openjdk-devel\n```\n\n*libXmu中包含libXt.so.6。*\n\n# 后处理\n\n安装好MATLAB后，发现无法通过**singularity exec**去调用。在**/environment**文件中将MATLAB的安装路径添加进PATH环境变量里面也无法直接运行（可能是写入的命令格式有问题，不确定）。之后查到可以定义一个recipe文件（append.def），通过已经生成的镜像重新构建镜像。recipe文件内容如下：\n\n```bash\nBootstrap: localimage\nFrom: tmp/\n\n%environment\n        export PATH=/usr/local/matlab/R2020a/bin:$PATH\n```\n\n然后重新构建镜像：\n\n```bash\nsudo singularity build --sandbox senv-matlab/ append.def\n```\n\n构建完成后，需要将镜像打包为可读写的格式（.img文件）。\n\n```bash\nsudo singularity build --writable senv-matlab.img senv-matlab/\n```\n\n这里生成的senv-matlab.img就可在服务器上使用了，也可在服务器上将其转换为压缩格式（.sif/.sqsh/.simg文件等）。不知道为什么直接在本地（Ubuntu 21.10）压缩后，在本地无运行镜像，会报告如下错误。\n\n```bash\nERROR  : Failed to mount squashfs image in (read only): Invalid argument\nABORT  : Retval = 255\n```\n\n# 参考\n\n1. https://zhuanlan.zhihu.com/p/394298249\n\n2. http://tigeroses.com/2021/05/30/singularity-container/",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}